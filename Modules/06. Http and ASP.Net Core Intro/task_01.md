# Задание "Базовый HTTP и основы ASP.Net Core"

*Задания, помеченные (\*) - не обязательные, но очень рекомендуемые*

## Задание 1. Переезд утилиты командой строки в Web
Разделите нашу утилиту комндной строки на сервер и клиент, т.е.:
- утилита читает команду
- отправляет запрос на сервер
- получает и сохраняет ответ

Детали реализации - на ваше усмотрение, но в целом самым простым выглядит вариант:
- каждая команда представлена на сервере отдельным endpoint (можно использовать разные HTTP-методы, если это выглядит логичным)
- параметры передаются через QueryString
- если требуется передать на вход или получить на выходе файл, то он просто передается в теле запроса/ответа

Например, строки запросов могут быть примерно такими (это только для иллюстрации):
```
PUT /products/mark_delete (список id - в теле) - помечает удаленными
PUT /categories/mark_undelete (список id - в теле) - помечает неудаленными 
GET /categories/timestamp - возвращает timestamp последнего изменения
GET /categories/modified?timestamp=<timestamp> (если не указан, то делается полная выгрузка) - возвращает изменения с момента указанного timestamp
```

К запросам можно добавить другие параметры, но (!) **не добавляйте** всяческие чувствительные параметры. Такие как:
- строка подключения к базе
- credentials
- имя файла, куда сохранять (зато это может остаться на клиенте)

(\*) Сделайте так, чтобы утилита могла работать в 2-х режимах: локально и через Web-сервис

## Задание 2. Middleware для поддержки API Key
[API Key](https://en.wikipedia.org/wiki/API_key) - это уникальный секретный (!!!) идентификатор, который обычно используются для аутентификации приложения, которое обращается к какому-то API (сервису) в Web.

Чаще всего API Key передает один сервис другому и для клиентских приложений его не используют (т.к. из клиентского приложения его можно украсть). 

Напишите Middleware, которое будет читать API Key из входящего запроса и проверять его по некоей базе разрешенных ключей

Более детально:
- ключ представляет собой Guid сохраненный в строку
- Middleware ищет ключ последовательно в предопределенных местах:
    - параметре `api_key` query string
    - в заголовке `X-API-Key`
    - в куке `X-API-Key`
- как только в одном из перечисленных мест найден ключ, его сверяют со списком валидных ключей
- если ключ не найден или найденный ключ невалидный обработка прерывается с ошибкой авторизации
- если ключ найден и он валиден - обработка выполняется дальше
- для подключения вашего Middleware добаьте Extension-метод, в котором указывается, где хранится список ключей 
    - можете выбрать свой вариант, но из простых - пусть это будет файл json
```
app.UseApiKey("keys.json");
```
- оформите код этого компонента в отдельную библиотеку и снабдите её тестами


## Задание 3. Защита сервиса 
Защитите сервис из первого задания с помощью API-ключей.

- добавьте использование вашего Middleware в сервис (для всех запросов)
- добавьте предачу API key из утилиты (сам ключ можно зашить в коде или запрашивать как один из параметров командной строки)